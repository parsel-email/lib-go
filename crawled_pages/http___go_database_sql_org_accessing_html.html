<!DOCTYPE html>
<html lang="en">
  <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accessing the Database</title>
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/journal.min.css" rel="stylesheet">
    <link href="/css/site.css" rel="stylesheet">
		<link href="http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700" rel="stylesheet" type="text/css">

    <link href="/css/prettify.css" type="text/css" rel="stylesheet" />
    <script src="/js/prettify.js" type="text/javascript"></script>
    <script src="/js/lang-go-rich.js" type="text/javascript"></script>
  </head>
  <body onload="prettyPrint()">
    <div class="container">
      <div class="row">
        <div class="span3">
          <div class="leftnav">
  <ul class="nav nav-list">
    
      
      <li class="nav-header ">
        <a href="index.html">Go database/sql tutorial</a>
      </li>
    
      
      <li class=" ">
        <a href="overview.html">Overview</a>
      </li>
    
      
      <li class=" ">
        <a href="importing.html">Importing a Database Driver</a>
      </li>
    
      
      <li class=" active">
        <a href="accessing.html">Accessing the Database</a>
      </li>
    
      
      <li class=" ">
        <a href="retrieving.html">Retrieving Result Sets</a>
      </li>
    
      
      <li class=" ">
        <a href="modifying.html">Modifying Data and Using Transactions</a>
      </li>
    
      
      <li class=" ">
        <a href="prepared.html">Using Prepared Statements</a>
      </li>
    
      
      <li class=" ">
        <a href="errors.html">Handling Errors</a>
      </li>
    
      
      <li class=" ">
        <a href="nulls.html">Working with NULLs</a>
      </li>
    
      
      <li class=" ">
        <a href="varcols.html">Working with Unknown Columns</a>
      </li>
    
      
      <li class=" ">
        <a href="connection-pool.html">The Connection Pool</a>
      </li>
    
      
      <li class=" ">
        <a href="surprises.html">Surprises, Antipatterns and Limitations</a>
      </li>
    
      
      <li class=" ">
        <a href="references.html">Related Reading and Resources</a>
      </li>
    
  </ul>
  <hr />
  <div class="license">
    <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" /></a>
  </div>
</div>

        </div>

        <div class="span9">
          <div class="page-header">
            <h1>Accessing the Database</h1>
            <a href="https://github.com/VividCortex/go-database-sql-tutorial/edit/gh-pages/accessing.md" class="improve-page btn btn-info" target="_blank">Improve this page</a>
          </div>
          <p>Now that you’ve loaded the driver package, you’re ready to create a database
object, a <code class="language-plaintext highlighter-rouge">sql.DB</code>.</p>

<p>To create a <code class="language-plaintext highlighter-rouge">sql.DB</code>, you use <code class="language-plaintext highlighter-rouge">sql.Open()</code>. This returns a <code class="language-plaintext highlighter-rouge">*sql.DB</code>:</p>

<pre class="prettyprint lang-go">
func main() {
	db, err := sql.Open("mysql",
		"user:password@tcp(127.0.0.1:3306)/hello")
	if err != nil {
		log.Fatal(err)
	}
	defer db.Close()
}
</pre>

<p>In the example shown, we’re illustrating several things:</p>

<ol>
  <li>The first argument to <code class="language-plaintext highlighter-rouge">sql.Open</code> is the driver name. This is the string that the driver used to register itself with <code class="language-plaintext highlighter-rouge">database/sql</code>, and is conventionally the same as the package name to avoid confusion. For example, it’s <code class="language-plaintext highlighter-rouge">mysql</code> for <a href="https://github.com/go-sql-driver/mysql">github.com/go-sql-driver/mysql</a>. Some drivers do not follow the convention and use the database name, e.g. <code class="language-plaintext highlighter-rouge">sqlite3</code> for <a href="https://github.com/mattn/go-sqlite3">github.com/mattn/go-sqlite3</a> and <code class="language-plaintext highlighter-rouge">postgres</code> for <a href="https://github.com/lib/pq">github.com/lib/pq</a>.</li>
  <li>The second argument is a driver-specific syntax that tells the driver how to access the underlying datastore. In this example, we’re connecting to the “hello” database inside a local MySQL server instance.</li>
  <li>You should (almost) always check and handle errors returned from all <code class="language-plaintext highlighter-rouge">database/sql</code> operations.  There are a few special cases that we’ll discuss later where it doesn’t make sense to do this.</li>
  <li>It is idiomatic to <code class="language-plaintext highlighter-rouge">defer db.Close()</code> if the <code class="language-plaintext highlighter-rouge">sql.DB</code> should not have a lifetime beyond the scope of the function.</li>
</ol>

<p>Perhaps counter-intuitively, <code class="language-plaintext highlighter-rouge">sql.Open()</code> <strong>does not establish any connections
to the database</strong>, nor does it validate driver connection parameters. Instead,
it simply prepares the database abstraction for later use. The first actual
connection to the underlying datastore will be established lazily, when it’s
needed for the first time. If you want to check right away that the database is
available and accessible (for example, check that you can establish a network
connection and log in), use <code class="language-plaintext highlighter-rouge">db.Ping()</code> to do that, and remember to check for
errors:</p>

<pre class="prettyprint lang-go">
err = db.Ping()
if err != nil {
	// do something here
}
</pre>

<p>Although it’s idiomatic to <code class="language-plaintext highlighter-rouge">Close()</code> the database when you’re finished with it,
<strong>the <code class="language-plaintext highlighter-rouge">sql.DB</code> object is designed to be long-lived.</strong> Don’t <code class="language-plaintext highlighter-rouge">Open()</code> and
<code class="language-plaintext highlighter-rouge">Close()</code> databases frequently. Instead, create <strong>one</strong> <code class="language-plaintext highlighter-rouge">sql.DB</code> object for each
distinct datastore you need to access, and keep it until the program is done
accessing that datastore. Pass it around as needed, or make it available somehow
globally, but keep it open. And don’t <code class="language-plaintext highlighter-rouge">Open()</code> and <code class="language-plaintext highlighter-rouge">Close()</code> from a short-lived
function. Instead, pass the <code class="language-plaintext highlighter-rouge">sql.DB</code> into that short-lived function as an
argument.</p>

<p>If you don’t treat the <code class="language-plaintext highlighter-rouge">sql.DB</code> as a long-lived object, you could experience
problems such as poor reuse and sharing of connections, running out of available
network resources, or sporadic failures due to a lot of TCP connections
remaining in <code class="language-plaintext highlighter-rouge">TIME_WAIT</code> status. Such problems are signs that you’re not using
<code class="language-plaintext highlighter-rouge">database/sql</code> as it was designed.</p>

<p>Now it’s time to use your <code class="language-plaintext highlighter-rouge">sql.DB</code> object.</p>

<p><strong>Previous: <a href="importing.html">Importing a Database Driver</a></strong>
<strong>Next: <a href="retrieving.html">Retrieving Result Sets</a></strong></p>

        </div>
      </div>
    </div>
  </body>
</html>
